<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1100" viewBox="0 0 1200 1100">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#222" />
    </marker>
    <style>
      .box { fill: #f7f7f7; stroke: #222; stroke-width: 1.5; }
      .local { fill: #e8f4ff; }
      .registry { fill: #fff4db; }
      .cluster { fill: #e7f7ef; }
      .domain { fill: #fde7e9; }
      .note { fill: #f3ebff; }
      .title { font: 700 16px Arial, sans-serif; }
      .text { font: 14px Arial, sans-serif; }
      .small { font: 12px Arial, sans-serif; }
      .arrow { stroke: #222; stroke-width: 1.5; marker-end: url(#arrow); }
    </style>
  </defs>

  <text class="title" x="30" y="30">Deployment Flow (Local Build → GHCR → k3s → Domain)</text>

  <!-- Local build -->
  <rect class="box local" x="30" y="60" width="330" height="160" rx="8" />
  <text class="text" x="45" y="90">Local Laptop (Windows)</text>
  <text class="small" x="45" y="115">VS Code + PowerShell</text>
  <text class="small" x="45" y="135">Docker Desktop builds images</text>
  <text class="small" x="45" y="155">docker build</text>

  <!-- Registry -->
  <rect class="box registry" x="430" y="80" width="300" height="120" rx="8" />
  <text class="text" x="445" y="110">GHCR (Image Registry)</text>
  <text class="small" x="445" y="135">ghcr.io/tunedsyntax/*</text>
  <text class="small" x="445" y="155">docker push</text>

  <!-- k3s cluster -->
  <rect class="box cluster" x="780" y="60" width="390" height="260" rx="8" />
  <text class="text" x="795" y="90">k3s Cluster (single cluster)</text>
  <text class="small" x="795" y="115">control-plane: k3s-master-01 (10.0.0.2)</text>
  <text class="small" x="795" y="135">workers: k3s-mgmt-01 (10.0.0.3), k3s-prod-01 (10.0.0.4)</text>
  <text class="small" x="795" y="165">Deployments pull images from GHCR</text>
  <text class="small" x="795" y="185">Services expose pods</text>
  <text class="small" x="795" y="205">Ingress (nginx) handles HTTP/HTTPS</text>

  <!-- Domain -->
  <rect class="box domain" x="780" y="350" width="390" height="140" rx="8" />
  <text class="text" x="795" y="380">Public Domain</text>
  <text class="small" x="795" y="405">citricloud.com → DNS</text>
  <text class="small" x="795" y="425">points to ingress IP</text>
  <text class="small" x="795" y="445">(49.13.95.148)</text>

  <!-- Staging note -->
  <rect class="box note" x="30" y="270" width="700" height="120" rx="8" />
  <text class="text" x="45" y="300">Optional: Separate Staging Cluster</text>
  <text class="small" x="45" y="325">If you want test on 159.69.246.126, that must be a different k3s cluster/context</text>
  <text class="small" x="45" y="345">Then you deploy to staging first, and production second</text>

  <!-- Lifecycle steps -->
  <rect class="box note" x="30" y="410" width="700" height="150" rx="8" />
  <text class="text" x="45" y="440">Lifecycle Steps (Build → Staging → Production → Domain)</text>
  <text class="small" x="45" y="465">1) Build locally with Docker Desktop</text>
  <text class="small" x="45" y="485">2) Push images to GHCR</text>
  <text class="small" x="45" y="505">3) Deploy to staging cluster (if you have one)</text>
  <text class="small" x="45" y="525">4) Deploy to production cluster</text>
  <text class="small" x="45" y="545">5) Domain points to ingress IP (citricloud.com → 49.13.95.148)</text>

  <!-- Deploy commands -->
  <rect class="box note" x="30" y="580" width="700" height="420" rx="8" />
  <text class="text" x="45" y="610">Deploy Commands (run from repo root)</text>
  <text class="small" x="45" y="635">Step 1: Build images</text>
  <text class="small" x="65" y="655">docker build -t ghcr.io/tunedsyntax/citricloud-backend:latest</text>
  <text class="small" x="65" y="673">./backend</text>
  <text class="small" x="65" y="691">docker build -t ghcr.io/tunedsyntax/citricloud-frontend:latest</text>
  <text class="small" x="65" y="709">./frontend</text>
  <text class="small" x="45" y="732">Step 2: Push to registry</text>
  <text class="small" x="65" y="752">docker push ghcr.io/tunedsyntax/citricloud-backend:latest</text>
  <text class="small" x="65" y="770">docker push ghcr.io/tunedsyntax/citricloud-frontend:latest</text>
  <text class="small" x="45" y="795">Step 3: Apply manifests</text>
  <text class="small" x="65" y="815">kubectl apply -f k8s/namespace.yaml</text>
  <text class="small" x="65" y="833">kubectl apply -f k8s/backend-deployment.yaml</text>
  <text class="small" x="65" y="851">kubectl apply -f k8s/backend-service.yaml</text>
  <text class="small" x="65" y="869">kubectl apply -f k8s/frontend-deployment.yaml</text>
  <text class="small" x="65" y="887">kubectl apply -f k8s/frontend-service.yaml</text>
  <text class="small" x="65" y="905">kubectl apply -f k8s/ingress.yaml</text>
  <text class="small" x="45" y="930">Step 4: Restart rollout</text>
  <text class="small" x="65" y="950">kubectl rollout restart deployment/citricloud-backend -n citricloud</text>
  <text class="small" x="65" y="968">kubectl rollout restart deployment/citricloud-frontend -n citricloud</text>

  <!-- Arrows -->
  <line class="arrow" x1="360" y1="140" x2="430" y2="140" />
  <line class="arrow" x1="730" y1="140" x2="780" y2="160" />
  <line class="arrow" x1="975" y1="320" x2="975" y2="350" />
</svg>
